---
title: handleUpdate (OfferUpdateRequest)
---

sequenceDiagram
    participant OfferService
    participant MaterialEntity
    participant OfferEntity
    participant MaterialOfferEntity
    participant SyncUpdaterResponse

    Note over OfferService: handleUpdate(OfferService offerService)
    OfferService->>MaterialEntity: getInsertingMaterialEntityIdMap()
    OfferService->>OfferEntity: getInsertingOfferEntityIdMap()
    OfferService->>MaterialOfferEntity: getInsertingMaterialOfferEntityIdMap()
    OfferService->>OfferService: getMaterialEntitiesByFacilityIdMaterialId(facilityId, materialId)
    OfferService->>OfferService: getMaterialOfferEntitiesByMaterialOfferIds(affectedMaterialEntities.keySet())
    OfferService->>OfferService: getOfferEntitiesByIds(getOfferEntityIds(affectedMaterialOfferEntities))
    OfferService->>OfferService: filterMaterialOfferEntitiesByOfferEntityIds(oldOfferEntitiesMap.keySet(), affectedMaterialOfferEntities)
    OfferService->>OfferService: filterMaterialEntitiesByMaterialEntityIds(getMaterialEntityIds(oldMaterialOfferEntitiesMap), affectedMaterialEntities)
    OfferService->>OfferService: createMaterial(newMaterialEntitiesMap, oldMaterialEntitiesMap)
    OfferService->>OfferService: createMaterialOffers(newMaterialOfferEntitiesMap, oldMaterialOfferEntitiesMap)
    OfferService->>OfferService: createOffers(newOfferEntitiesMap, oldOfferEntitiesMap)
    OfferService->>OfferService: updateMaterial(newMaterialEntitiesMap, oldMaterialEntitiesMap, this)
    OfferService->>OfferService: updateMaterialOffers(newMaterialOfferEntitiesMap, oldMaterialOfferEntitiesMap, this)
    OfferService->>OfferService: updateOffers(newOfferEntitiesMap, oldOfferEntitiesMap, this)
    OfferService->>OfferService: deleteMaterials(newMaterialEntitiesMap, oldMaterialEntitiesMap)
    OfferService->>OfferService: deleteMaterialOffers(newMaterialOfferEntitiesMap, oldMaterialOfferEntitiesMap)
    OfferService->>OfferService: deleteOffers(newOfferEntitiesMap, oldOfferEntitiesMap)
    OfferService->>OfferService: handleUpdateOffers(createMaterials, createMaterialOffers, createOffers, updateMaterials, updateMaterialOffers, updateOffers, deleteMaterials, deleteMaterialOffers, deleteOffers)
    OfferService-->>SyncUpdaterResponse: Return SyncUpdaterResponse
