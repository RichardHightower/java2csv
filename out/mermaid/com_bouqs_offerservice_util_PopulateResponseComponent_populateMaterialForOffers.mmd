---
title: populateMaterialForOffers (PopulateResponseComponent)
---

sequenceDiagram
    participant OfferEntity
    participant CompletableFuture
    participant OfferResponse
    participant OfferResponseBuilder
    participant MaterialOfferEntity
    participant MaterialOfOfferResponse
    participant materialOfferDao
    participant materialDao
    participant Collections
    participant Map
    participant Collectors

    OfferEntity->>CompletableFuture: Stream offerEntities
    CompletableFuture->>OfferResponse: Supply async
    OfferResponseBuilder->>OfferResponse: Build offerResponse
    MaterialOfferEntity->>materialOfferDao: Find by skuEntityId
    materialOfferDao-->>MaterialOfferEntity: Return materialOfferEntities
    materialDao->>materialOfferEntity: Find by materialOfferId
    materialDao-->>MaterialOfferEntity: Return materialEntities
    MaterialOfOfferResponse->>MaterialOfOfferResponse: Build materialOfOfferResponse
    MaterialOfOfferResponse->>MaterialOfferEntity: Map materialOfOfferResponse to materialOfferEntity
    MaterialOfOfferResponse->>MaterialOfOfferResponse: Group materialOfOfferResponse by materialId
    OfferResponseBuilder->>OfferResponse: Set materials and availableUnits
    CompletableFuture-->>OfferResponse: Return offerResponse
    CompletableFuture->>CompletableFuture: Join
    CompletableFuture-->>OfferResponse: Return offerResponse
    CompletableFuture->>List: Stream completableOffers
    List->>Collectors: Map completableOffers to list
    Collectors-->>List: Return list
    List-->>OfferResponse: Return list
