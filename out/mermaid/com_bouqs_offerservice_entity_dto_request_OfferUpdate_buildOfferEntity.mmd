sequenceDiagram
    participant Utils
    participant JsonFactory
    participant Json
    participant log
    participant OfferEntity
    participant DeliveryWindow
    participant LocalDate
    participant Arrays
    participant ArrayList

    Note over Utils: buildOfferEntityId()
    Note over JsonFactory: getJson()
    Note over Json: toObject()
    Note over log: warn()
    Note over LocalDate: parse()
    Note over Arrays: asList()
    Note over ArrayList: ArrayList<>()
    Note over OfferEntity: builder()

    activate Utils
    Utils->>Utils: buildOfferEntityId(facilityId, shipDate, skuId, carrierMethodId, shipMethodId, regionId)
    deactivate Utils

    activate JsonFactory
    JsonFactory->>JsonFactory: getJson()
    deactivate JsonFactory

    activate Json
    Json->>Json: toObject(deliveryWindows, DeliveryWindow[].class)
    deactivate Json

    alt JsonException
        activate log
        log->>log: warn("unable to parse delivery windows json to object: " + deliveryWindows, e)
        deactivate log

        activate ArrayList
        ArrayList-->>Json: Return new ArrayList<>()
        deactivate ArrayList
    else
        activate Arrays
        Arrays-->>Json: Return Arrays.asList(deliveryWindows)
        deactivate Arrays
    end

    activate OfferEntity
    OfferEntity-->>OfferEntity: builder()
    OfferEntity->>OfferEntity: id(id)
    OfferEntity->>OfferEntity: facilityId(facilityId)
    OfferEntity->>LocalDate: parse(shipDate)
    OfferEntity->>OfferEntity: skuId(skuId)
    OfferEntity->>OfferEntity: carrierMethodId(carrierMethodId)
    OfferEntity->>OfferEntity: shipMethodId(shipMethodId)
    OfferEntity->>OfferEntity: regionId(regionId)
    OfferEntity->>OfferEntity: ofbizId(ofbizId)
    OfferEntity->>OfferEntity: productId(productId)
    OfferEntity->>OfferEntity: ecomId(ecomId)
    OfferEntity->>OfferEntity: ofbizFacilityId(ofbizFacilityId)
    OfferEntity->>OfferEntity: facilityName(facilityName)
    OfferEntity->>OfferEntity: shipMethodName(shipMethodName)
    OfferEntity->>LocalDate: parse(deliveryDate)
    OfferEntity->>OfferEntity: cutoff(cutoff)
    OfferEntity->>OfferEntity: airSectors(airSectors)
    OfferEntity->>OfferEntity: zipCodeExemptions(zipCodeExemptions)
    OfferEntity->>OfferEntity: timeZone(facilityTimeZone)
    OfferEntity->>OfferEntity: deliveryWindows(deliveryWindows)
    OfferEntity->>OfferEntity: facilityCapacity(facilityCapacity)
    OfferEntity->>OfferEntity: carrierMethodCapacity(carrierMethodCapacity)
    OfferEntity->>OfferEntity: priority(priority)
    OfferEntity->>OfferEntity: facilityRanking(facilityRanking)
    OfferEntity->>OfferEntity: productionLeadTime(productionLeadTime)
    OfferEntity->>LocalDateTime: parse(timestamp)
    OfferEntity->>OfferEntity: essentialMaterialIds(essentialMaterialIds)
    OfferEntity->>Constants: INITIAL_VERSION
    OfferEntity->>Utils: calculateExpiration(cutoff)
    OfferEntity-->>OfferEntity: build()
    deactivate OfferEntity

    Note over OfferEntity: Return OfferEntity
