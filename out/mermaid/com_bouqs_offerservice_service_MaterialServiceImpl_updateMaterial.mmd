---
title: Update Material
---

sequenceDiagram
    participant MaterialServiceImpl
    participant MaterialEntity
    participant OptimisticLockingException
    participant CRUDResponse
    participant MaterialRequest
    participant log
    participant materialDao

    MaterialServiceImpl->>log: Start updateMaterial
    MaterialServiceImpl->>MaterialServiceImpl: getMaterialById(materialRequest.getId())
    MaterialServiceImpl->>MaterialEntity: existedMaterialEntity = getMaterialById(materialRequest.getId())
    MaterialServiceImpl->>MaterialRequest: materialRequest.getVersion()
    MaterialServiceImpl->>MaterialEntity: existedMaterialEntity.getVersion()
    alt Version Check
        MaterialEntity-->>MaterialServiceImpl: Return existedMaterialEntity.getVersion()
        MaterialServiceImpl->>log: OptimisticLockingException
        MaterialServiceImpl->>OptimisticLockingException: throw OptimisticLockingException(materialRequest.getVersion())
    else Upsert Material
        MaterialServiceImpl->>MaterialRequest: populateMaterialEntity(materialRequest, true)
        MaterialServiceImpl->>log: upsertingMaterialEntity: json.toJson(upsertingMaterialEntity)
        MaterialServiceImpl->>materialDao: save(upsertingMaterialEntity)
        materialDao-->>MaterialServiceImpl: Return saved upsertingMaterialEntity
        MaterialServiceImpl->>log: End updateMaterial
        MaterialServiceImpl->>CRUDResponse: Return CRUDResponse.builder().id(existedMaterialEntity.getId()).message("Material updated successfully").success("true").build()
    end
